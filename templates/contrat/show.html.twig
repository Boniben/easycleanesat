{% extends 'base.html.twig' %}

{% block title %}Contrat
	{{ contrat.numero }}
{% endblock %}

{% block body %}
	<div class="page-header">
		<div>
			<h1>Contrat
				{{ contrat.numero }}</h1>
			<p class="text-muted text-sm">{{ contrat.sitesClient.client.nom }}
				—
				{{ contrat.sitesClient.nom }}</p>
		</div>
		<div class="btn-group">
			<a href="{{ path('app_zones_client_new', {'site_id': contrat.sitesClient.id}) }}" class="btn btn-primary">+ Ajouter une zone</a>
			{% if app.user and is_granted('ROLE_ADMIN') %}
				<a href="{{ path('app_contrat_edit', {'id': contrat.id}) }}" class="btn btn-secondary">Modifier</a>
			{% endif %}
		</div>
	</div>

	{% for zone in contrat.sitesClient.zonesClients %}
		<div class="card">
			<div class="card-header">
				<h2>{{ zone.nom }}</h2>
				<div class="btn-group">
					<span class="badge badge-primary">{{ zone.typeZone ? zone.typeZone.nom : 'Sans type' }}</span>
					<a href="{{ path('app_zones_client_edit', {'id': zone.id}) }}" class="btn btn-outline btn-sm">Modifier</a>
				</div>
			</div>

			<h3>Supports</h3>
			{% if zone.supportClients|length > 0 %}
				<ul class="info-list">
					{% for support in zone.supportClients %}
						<li>
							<span class="info-label">Support :</span>
							<span>{{ support.typeSupport.nom }}</span>
						</li>
					{% endfor %}
				</ul>
			{% else %}
				<p class="text-muted text-sm">Aucun support pour cette zone</p>
			{% endif %}

			<a href="{{ path('app_support_client_new', {'zone_id': zone.id}) }}" class="btn btn-outline btn-sm mt-1">+ Ajouter un support</a>
		</div>
	{% else %}
		<div class="card">
			<div class="empty-state">
				<p>Aucune zone pour ce site</p>
				<a href="{{ path('app_zones_client_new', {'site_id': contrat.sitesClient.id}) }}" class="btn btn-primary">Créer la première zone</a>
			</div>
		</div>
	{% endfor %}
        <h3>Supports :</h3>
        <ul>
            {% for support in zone.supportsClient %}
                <li>{{ support.typeSupport.nom }}</li>
            {% else %}
                <li>Aucun support</li>
            {% endfor %}
        </ul>

        <a href="{{ path('app_zones_client_edit', {'id': zone.id}) }}">Modifier une zone</a>
    {% else %}
        <p>Aucune zone pour ce site</p>
    {% endfor %}

    <hr>
    <a href="{{ path('app_client_show', {'id': contrat.sitesClient.client.id}) }}">Retour au client</a>
    <a href="{{ path('app_contrat_edit', {'id': contrat.id}) }}">Modifier</a>
    {{ include('contrat/_delete_form.html.twig') }}

    <section class="dashboard-actions">
    <a class="dashboard-action" href="{{ path('app_intervention_new', {'contrat_id': contrat.id}) }}">
        <strong>Ajouter une intervention</strong>
        <span>Créer une nouvelle intervention pour {{ contrat.sitesClient.client.nom }}, {{ contrat.sitesClient.nom }}, pour le contrat {{ contrat.numero }}.</span>
    </a>
    </section>

	<div class="btn-group mt-3">
		<a href="{{ path('app_client_show', {'id': contrat.sitesClient.client.id}) }}" class="btn btn-secondary">← Retour au client</a>
		{% if app.user and is_granted('ROLE_ADMIN') %}
			{{ include('contrat/_delete_form.html.twig') }}
		{% endif %}
	</div>
{% endblock %}
